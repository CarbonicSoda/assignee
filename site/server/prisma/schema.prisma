generator client {
  provider = "prisma-client"
  output   = "../src/prisma"
}

datasource db {
  provider = "sqlite"
  url      = "file:../src/app.db"
}

model User {
  uid Int @id @default(autoincrement())

  mail String @unique
  name String

  created DateTime @default(now())
  updated DateTime @updatedAt

  Pass   Pass?
  Sess   Sess[]
  Member Member[]
  Work   Work[]
}

model Pass {
  uid Int @id

  hash Bytes
  salt Bytes

  created DateTime @default(now())
  updated DateTime @updatedAt

  User User @relation(fields: [uid], references: [uid], onUpdate: Restrict, onDelete: Cascade)
}

model Sess {
  sid Int @id @default(autoincrement())
  uid Int

  hash Bytes
  salt Bytes

  created DateTime @default(now())
  updated DateTime @updatedAt

  User User @relation(fields: [uid], references: [uid], onUpdate: Restrict, onDelete: Cascade)

  @@index([uid])
}

model Team {
  tid Int @id @default(autoincrement())

  name String
  desc String

  created DateTime @default(now())
  updated DateTime @updatedAt

  Invite Invite?
  Member Member[]
  Task   Task[]
}

model Invite {
  tid Int @id

  code Bytes @unique

  created DateTime @default(now())
  updated DateTime @updatedAt

  Team Team @relation(fields: [tid], references: [tid], onUpdate: Restrict, onDelete: Cascade)
}

model Member {
  uid Int
  tid Int

  auth Boolean

  created DateTime @default(now())
  updated DateTime @updatedAt

  User User @relation(fields: [uid], references: [uid], onUpdate: Restrict, onDelete: Cascade)
  Team Team @relation(fields: [tid], references: [tid], onUpdate: Restrict, onDelete: Cascade)

  @@id([uid, tid], name: "pk")
  @@index([tid])
}

model Task {
  aid Int @id @default(autoincrement())
  tid Int

  name String
  desc String
  dead DateTime

  created DateTime @default(now())
  updated DateTime @updatedAt

  Team      Team        @relation(fields: [tid], references: [tid], onUpdate: Restrict, onDelete: Cascade)
  TaskFiles TaskFiles[]
  Work      Work[]

  @@index([tid])
}

model TaskFiles {
  fid Int @id @default(autoincrement())
  aid Int

  name String
  blob Bytes

  created DateTime @default(now())
  updated DateTime @updatedAt

  Task Task @relation(fields: [aid], references: [aid], onUpdate: Restrict, onDelete: Cascade)

  @@unique([aid, name])
}

model Work {
  sid Int @id @default(autoincrement())
  uid Int
  aid Int

  done Boolean @default(false)
  mark Grades?
  comm String?

  created DateTime @default(now())
  updated DateTime @updatedAt

  User      User        @relation(fields: [uid], references: [uid], onUpdate: Restrict, onDelete: Cascade)
  Task      Task        @relation(fields: [aid], references: [aid], onUpdate: Restrict, onDelete: Cascade)
  WorkFiles WorkFiles[]

  @@unique([uid, aid])
}

model WorkFiles {
  fid Int @id @default(autoincrement())
  sid Int

  name String
  blob Bytes

  created DateTime @default(now())
  updated DateTime @updatedAt

  Work Work @relation(fields: [sid], references: [sid], onUpdate: Restrict, onDelete: Cascade)

  @@unique([sid, name])
}

enum Grades {
  A
  B
  C
  F
}
